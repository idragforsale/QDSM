<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QDSM Preview</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
</style>
</head>
<body>
<h1>QDSM API Preview</h1>
<table id="dataTable">
    <thead>
        <tr id="tableHeader"></tr>
    </thead>
    <tbody id="tableBody"></tbody>
</table>

<script>
const apiURL = 'https://it.nkh.go.th/qdsm/ajax/export_document_api.php?type=json';

// ใช้ CORS proxy สำหรับเรียก API ข้าม domain
const proxy = 'https://api.allorigins.win/get?url=';

fetch(proxy + encodeURIComponent(apiURL))
    .then(response => response.json())
    .then(data => {
        // data.contents คือ JSON แบบ string
        const jsonData = JSON.parse(data.contents);

        if (jsonData.length === 0) {
            document.getElementById('tableBody').innerHTML = '<tr><td colspan="10">ไม่มีข้อมูล</td></tr>';
            return;
        }

        // สร้าง header table จาก key ของ object แรก
        const headers = Object.keys(jsonData[0]);
        const headerRow = document.getElementById('tableHeader');
        headers.forEach(h => {
            const th = document.createElement('th');
            th.textContent = h;
            headerRow.appendChild(th);
        });

        // สร้าง row table
        const tbody = document.getElementById('tableBody');
        jsonData.forEach(item => {
            const tr = document.createElement('tr');
            headers.forEach(h => {
                const td = document.createElement('td');
                td.textContent = item[h];
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });
    })
    .catch(err => {
        console.log('ไม่สามารถดึงข้อมูลได้', err);
        document.getElementById('tableBody').innerHTML = '<tr><td colspan="10">ไม่สามารถดึงข้อมูลได้</td></tr>';
    });
</script>
</body>
</html>
